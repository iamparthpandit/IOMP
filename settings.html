<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Settings - IOMP</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
<script>tailwind.config = {theme: {extend: {colors: {"iomp-blue": {dark: "#1e3a8a", light: "#3b82f6"}}}}};</script>
</head>
<body class="bg-gray-50">
<div class="min-h-screen">
  <!-- Header -->
  <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <button onclick="window.location.href='/'" class="text-gray-600 hover:text-gray-900">
            <i class="fas fa-arrow-left text-xl"></i>
          </button>
          <img src="/IOMP_LOGO.png" alt="IOMP Logo" class="h-8 w-8">
          <h1 class="text-2xl font-bold text-gray-900">Settings</h1>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto px-4 sm:px-6 py-8">
    <!-- Profile Settings -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4">
        <i class="fas fa-user mr-2"></i>Profile Information
      </h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Name</label>
          <input type="text" id="settingName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-iomp-blue-light focus:ring-iomp-blue-light" readonly>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Email</label>
          <input type="email" id="settingEmail" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-iomp-blue-light focus:ring-iomp-blue-light" readonly>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Role</label>
          <input type="text" id="settingRole" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-iomp-blue-light focus:ring-iomp-blue-light" readonly>
        </div>
      </div>
    </div>

    <!-- Notification Settings -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4">
        <i class="fas fa-bell mr-2"></i>Notifications
      </h2>
      <div class="space-y-4">
        <div class="flex items-center justify-between">
          <div>
            <p class="font-medium text-gray-900">Email Notifications</p>
            <p class="text-sm text-gray-500">Receive notifications via email</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" id="emailNotifications" class="sr-only peer" checked>
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-iomp-blue-light"></div>
          </label>
        </div>
        <div class="flex items-center justify-between">
          <div>
            <p class="font-medium text-gray-900">Push Notifications</p>
            <p class="text-sm text-gray-500">Receive push notifications</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" id="pushNotifications" class="sr-only peer" checked>
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-iomp-blue-light"></div>
          </label>
        </div>
        <div class="flex items-center justify-between">
          <div>
            <p class="font-medium text-gray-900">Event Reminders</p>
            <p class="text-sm text-gray-500">Get reminded about upcoming events</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" id="eventReminders" class="sr-only peer" checked>
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-iomp-blue-light"></div>
          </label>
        </div>
        <div class="flex items-center justify-between">
          <div>
            <p class="font-medium text-gray-900">Assignment Alerts</p>
            <p class="text-sm text-gray-500">Get notified about assignments</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" id="assignmentAlerts" class="sr-only peer" checked>
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-iomp-blue-light"></div>
          </label>
        </div>
      </div>
    </div>

    <!-- Privacy Settings -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
      <h2 class="text-xl font-bold text-gray-900 mb-4">
        <i class="fas fa-lock mr-2"></i>Privacy
      </h2>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Profile Visibility</label>
          <select id="profileVisibility" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-iomp-blue-light focus:ring-iomp-blue-light">
            <option value="public">Public</option>
            <option value="private">Private</option>
            <option value="friends">Friends Only</option>
          </select>
        </div>
        <div class="flex items-center justify-between">
          <div>
            <p class="font-medium text-gray-900">Show Email</p>
            <p class="text-sm text-gray-500">Display email on your profile</p>
          </div>
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" id="showEmail" class="sr-only peer">
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-iomp-blue-light"></div>
          </label>
        </div>
      </div>
    </div>

    <!-- Save Button -->
    <div class="flex justify-end">
      <button id="saveSettings" class="bg-iomp-blue-light text-white px-6 py-2 rounded-lg hover:bg-iomp-blue-dark transition">
        <i class="fas fa-save mr-2"></i>Save Changes
      </button>
    </div>
  </main>
</div>

<script>
  // Auth check
  const token = localStorage.getItem('token');
  if (!token) window.location.href = '/login';

  // Load settings
  async function loadSettings() {
    try {
      const response = await fetch('/api/auth/settings', {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await response.json();
      
      if (data.success) {
        const settings = data.settings;
        document.getElementById('settingName').value = settings.profile.name;
        document.getElementById('settingEmail').value = settings.profile.email;
        document.getElementById('settingRole').value = settings.profile.role;
        
        document.getElementById('emailNotifications').checked = settings.notifications.email_notifications;
        document.getElementById('pushNotifications').checked = settings.notifications.push_notifications;
        document.getElementById('eventReminders').checked = settings.notifications.event_reminders;
        document.getElementById('assignmentAlerts').checked = settings.notifications.assignment_alerts;
        
        document.getElementById('profileVisibility').value = settings.privacy.profile_visibility;
        document.getElementById('showEmail').checked = settings.privacy.show_email;
      }
    } catch (error) {
      console.error('Error loading settings:', error);
    }
  }

  // Save settings
  document.getElementById('saveSettings').addEventListener('click', async () => {
    try {
      const settings = {
        notifications: {
          email_notifications: document.getElementById('emailNotifications').checked,
          push_notifications: document.getElementById('pushNotifications').checked,
          event_reminders: document.getElementById('eventReminders').checked,
          assignment_alerts: document.getElementById('assignmentAlerts').checked
        },
        privacy: {
          profile_visibility: document.getElementById('profileVisibility').value,
          show_email: document.getElementById('showEmail').checked
        }
      };

      const response = await fetch('/api/auth/settings', {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(settings)
      });

      const data = await response.json();
      if (data.success) {
        alert('Settings saved successfully!');
      }
    } catch (error) {
      console.error('Error saving settings:', error);
      alert('Failed to save settings');
    }
  });

  loadSettings();
</script>
</body>
</html>
